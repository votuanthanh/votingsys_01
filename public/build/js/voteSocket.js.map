{"version":3,"sources":["voteSocket.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"voteSocket.js","sourcesContent":["$(document).ready(function(){\n    var host = $('.hide_vote_socket').data('host');\n    var port = $('.hide_vote_socket').data('port');\n    var link = (port == '') ? host : host + \":\" + port;\n    var socket = io.connect(link);\n\n    if ($('.manage-poll-count-participant').text() == '0') {\n        $('.delete-all-participants').hide();\n    }\n\n    //socket vote poll\n    socket.on('votes', function (data) {\n        var pollId = $('.hide-vote').data('pollId');\n        var socketData = $.parseJSON(data);\n\n        if (socketData.success && socketData.poll_id == pollId) {\n            $('.count-participant').html(socketData.count_participant);\n            jQuery.each(socketData.result, function(key, value ) {\n                //update count vote latest\n                $('#id1' + value.option_id).html(value.count_vote);\n                $('#id2' + value.option_id).html(value.count_vote);\n                $('.result-vote-poll').empty();\n                $('.result-vote-poll').append(socketData.html_result_vote)\n                $('.model-show-details').empty();\n                $('.model-show-details').off('keyup');\n                $('.model-show-details').append(socketData.html);\n                $('.search-row-detail').searchRow();\n            });\n\n            if (typeof socketData.horizontalOption != 'undefined') {\n                $('.li-parent-vote').not('.parent-vote-new-option').remove();\n                $('.horizontal-overflow').prepend(socketData.horizontalOption);\n                $('[data-toggle=\"tooltip\"]').tooltip();\n            }\n\n            if (typeof socketData.verticalOption != 'undefined') {\n                $('.vertical-overflow').html(socketData.verticalOption);\n            }\n\n            if (typeof socketData.timelineOption != 'undefined') {\n                var $table = $(socketData.timelineOption);\n                var url = $('#timeline').data('get-cookie');\n\n                $.get(url, function (data) {\n                    $('.tb-option').remove();\n\n                    $table.find('.nsep.action-box').each(function (index) {\n                        var $actionbox = $(this);\n                        var dataAction = $actionbox.find('.inline-edit').data('edit-voted')\n\n                        // Condition to allow edit or delete option that was voted\n                        var userChoiceSingle = data.user && dataAction.vote_id && data.user.id == dataAction.id;\n                        var userChoiceMutiple = data.user && dataAction.user_id && data.user.id == dataAction.user_id;\n                        var haveCookie = data.cookie && data.cookie.indexOf(dataAction.id) > -1;\n                        var participantChoice = !dataAction.vote_id && !dataAction.user_id && haveCookie;\n\n                        if (userChoiceSingle || userChoiceMutiple || participantChoice) {\n                            $actionbox.removeClass('hide');\n                        } else {\n                            $actionbox.removeClass('hide').empty();\n                        }\n                    });\n\n                    if ($('.fixed-header').length) {\n                        $('.fixed-header').after($table);\n\n                        createWaypointThead();\n\n                        $('.td-fixed-check').remove();\n                        createFixedTfoot();\n\n                        return;\n                    }\n\n                    $('#timeline').append($table);\n\n                    createFixedTfoot();\n                }, 'json');\n            }\n\n            if ($('.bar-pie-chart').html() == \"\") {\n                $('.bar-pie-chart').html(socketData.html_pie_bar_chart);\n            }\n\n            if ($('.manage-poll-count-participant').text() == '0') {\n                $('.li-result-table').removeClass('hide-result-li');\n                $('.pie_bar_chart_manage').append(socketData.html_pie_bar_manage_chart);\n                $('.manage-poll-count-participant').text('1');\n            }\n\n            $('.delete-all-participants-soket').css('display', 'block');\n            $('.div-delete-participant').removeClass('col-md-activity-jp');\n            $('.btn-duplicate').css('display', 'none');\n            $('.menu-add-soket').css('display', 'block');\n\n            $('.show-piechart').empty();\n            $('.show-piechart').append(socketData.htmlPieChart);\n            $('.show-barchart').empty();\n            $('.show-barchart').append(socketData.htmlBarChart);\n        }\n    });\n\n    //socket comment poll\n    socket.on('comment', function (data) {\n        var pollId = $('.hide-vote').data('pollId');\n        var isOwnerPoll = $('.hide-vote').data('isOwnerPoll');\n\n        if ($.parseJSON(data).success && $.parseJSON(data).poll_id == pollId) {\n            if (isOwnerPoll == \"1\") {\n                $('.comments').append($.parseJSON(data).htmlOwner);\n            } else {\n                $('.comments').append($.parseJSON(data).htmlNotOwner);\n            }\n            var commentCount = $('.comment-count').html();\n            $('.comment-count').html(parseInt(commentCount) + 1);\n            $('#content' + pollId).val('');\n        }\n\n        var scrollHeight = $('.comments').prop('scrollHeight');\n        if (scrollHeight > 300) {\n            $('.comments').animate({\n                    scrollTop: scrollHeight\n            }, 1000);\n        }\n    });\n\n    //socket close poll\n    socket.on('closePoll', function (data) {\n        var pollId = $('.hide-vote-details').data('pollId');\n\n        if ($.parseJSON(data).success && $.parseJSON(data).poll_id == pollId) {\n            window.location.href = $.parseJSON(data).link_user;\n        }\n    });\n\n     //socket reopen poll\n    socket.on('reopenPoll', function (data) {\n        var pollId = $('.hide-poll-closed').data('pollId');\n        if ($.parseJSON(data).success && $.parseJSON(data).poll_id == pollId) {\n\n            window.location.href = $.parseJSON(data).link_user;\n        }\n    });\n\n    //socket delete all participant of poll\n    socket.on('deleteParticipant', function (data) {\n        var pollId = $('.hide-vote').data('pollId');\n\n        if ($.parseJSON(data).poll_id == pollId) {\n            $('.count-participant').html('0');\n            $('.model-show-details').empty();\n            $('.show-piechart').empty();\n            $('.show-barchart').empty();\n            $('.bar-pie-chart').empty();\n            $('.show-details_default').addClass('in active');\n            $('.model-show-details').append($.parseJSON(data).modal_details_empty);\n            jQuery.each($.parseJSON(data).result, function(key,value ) {\n                $('#id1' + value.option_id).html('0');\n                $('#id2' + value.option_id).html('0');\n                $('#id3' + value.option_id).html('0');\n            });\n        }\n    });\n\n    //socket close poll\n    socket.on('editPoll', function (data) {\n        var pollId = $('.hide-vote-details').data('pollId');\n\n        if ($.parseJSON(data).success && $.parseJSON(data).poll_id == pollId) {\n            window.location.href = $.parseJSON(data).link_user;\n        }\n    });\n\n    socket.on('emit-close-poll', function (data) {\n        if (link = data.link) {\n            window.location.href = link;\n        }\n    })\n\n    // auto close poll when time out\n    var userLink = $('.js-date-close').data('link');\n    var dateClose = $('.js-date-close').data('date-close');\n    var now = moment().unix();\n    var timeStart = ((dateClose - now) * 1000) + 1000;\n\n    if (dateClose != '' && now < dateClose) {\n        setTimeout(function () {\n            socket.emit('close-poll', userLink);\n        }, timeStart)\n    }\n});\n"]}