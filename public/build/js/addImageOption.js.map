{"version":3,"sources":["addImageOption.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addImageOption.js","sourcesContent":["function jqAddImageOption(config) {\n    this.initDom(config);\n    this.bindEvents();\n}\n\njqAddImageOption.prototype.extendOptions = function (config) {\n    var defaults = {\n        /**\n         * DOM of option\n         */\n        wrapperPoll: '.poll-option',\n        btnChooseImage: '.upload-photo',\n        parentOption: '.form-group',\n        thumbImageOption: '.preview-image',\n        elParentOption: '',\n\n        srcThumbImageOption: '',\n        elBtnChooseImage: '',\n        messages: 'div[data-poll]',\n\n        /**\n         * DOM of win-frame option to add image that by link or upload file\n         */\n        frImage: \"#frame-upload-image\",\n        frUploadFile: '.photo-tb-upload',\n        frPreImage: '.img-pre-option',\n        frAddImgLink: '.add-image-by-link',\n        frInputText: '.photo-tb-url-txt',\n        frDelPhoto: '.photo-tb-del',\n        frConfirmYes: '.btn-yes',\n        frInputFileTemp: '.fileImgTemp',\n        frContentError : '.error-win-img',\n    }\n    var options = $.extend(defaults, config);\n\n    return options;\n}\n\njqAddImageOption.prototype.initDom = function (config) {\n    var options = this.extendOptions(config);\n\n    this.wrapperPoll = options.wrapperPoll;\n    this.btnChooseImage = options.btnChooseImage;\n    this.parentOption = options.parentOption;\n    this.thumbImageOption = options.thumbImageOption;\n    this.elParentOption = options.elParentOption;\n\n    this.srcThumbImageOption = options.srcThumbImageOption;\n    this.elBtnChooseImage = options.elBtnChooseImage;\n\n    // Object Message For Client\n    this.messages = $(options.messages).data(options.messages.match(/div\\[data-(.*)\\]/)[1]).message;\n\n    this.frUploadFile = options.frUploadFile;\n    this.frImage = options.frImage;\n    this.frPreImage = options.frPreImage;\n    this.frAddImgLink = options.frAddImgLink;\n    this.frInputText = options.frInputText;\n    this.frDelPhoto = options.frDelPhoto;\n    this.frConfirmYes = options.frConfirmYes;\n    this.frInputFileTemp = options.frInputFileTemp;\n    this.frContentError = options.frContentError;\n    this.frInputHiddenTemp = '';\n    this.addByLink = false;\n}\n\njqAddImageOption.prototype.bindEvents = function () {\n    $(this.wrapperPoll).on('click', this.btnChooseImage, this.showIframe.bind(this));\n    $(this.frUploadFile).on('click', this.showBoxUpload.bind(this));\n    $(this.frInputFileTemp).on('change', this.preImage.bind(this));\n    $(this.frAddImgLink).on('click', this.addImageByLink.bind(this));\n    $(this.frDelPhoto).on('click', this.delPhoto.bind(this));\n    $(this.frConfirmYes).on('click', this.confirmYes.bind(this));\n    $(this.wrapperPoll).on('click', this.thumbImageOption, this.editPhoto.bind(this));\n}\n\njqAddImageOption.prototype.addImageByLink = function () {\n    var urlImage = $(this.frInputText).val().trim();\n\n    if (urlImage == '') {\n        this.showMessage(this.messages.empty_link_image);\n\n        return;\n    }\n\n    if (!this.checkExtensionImage(urlImage)) {\n        this.showMessage(this.messages.not_type_url_image);\n\n        return;\n    }\n\n    this.checkTimeLoadImage(urlImage, function (result) {\n        if (result == 'success') {\n            this.removeMessage();\n\n            var idOption = this.elParentOption.attr('id');\n            var inputUrlText = $('<input>').attr({\n                type: 'hidden',\n                name: 'optionImage[' + idOption + ']',\n                value: ''\n            });\n\n            if (this.elParentOption.find('input[type=hidden]').length) {\n                this.elParentOption.find('input[type=hidden]').remove();\n            }\n\n            this.elParentOption.prepend(inputUrlText);\n            this.frInputHiddenTemp = urlImage;\n            this.addByLink = true;\n            $(this.frInputFileTemp).val('');\n            $(this.frPreImage).attr('src', urlImage);\n            $(this.frInputText).val('');\n\n        } else if (result == 'error') {\n            this.showMessage(this.messages.not_type_url_image);\n        } else {\n            this.showMessage(this.messages.time_out_url_image);\n        }\n    }.bind(this));\n}\n\njqAddImageOption.prototype.showMessage = function (message) {\n    $(this.frContentError).text(message).show();\n}\n\njqAddImageOption.prototype.removeMessage = function (message) {\n    $(this.frContentError).text('').hide();\n}\n\njqAddImageOption.prototype.editPhoto = function (e) {\n    var $this = e.currentTarget;\n    var srcThumImg = $($this).prop('src');\n    this.setSrcFramePhoto(srcThumImg);\n    $(this.frImage).modal('show');\n}\n\njqAddImageOption.prototype.setSrcFramePhoto = function (srcImg) {\n    this.removeMessage();\n    $(this.frPreImage).attr('src', srcImg);\n    $(this.frInputText).val('');\n}\n\njqAddImageOption.prototype.delPhoto = function () {\n    console.log($(this.frInputFileTemp));\n    $(this.frPreImage).attr('src', '');\n    $(this.frInputFileTemp).val('');\n    $(this.frInputText).val('');\n    this.removeMessage();\n    this.frInputHiddenTemp = '';\n}\n\njqAddImageOption.prototype.confirmYes = function () {\n    var srcPreImage = $(this.frPreImage).attr('src');\n    var elThumbImg = this.elParentOption.find('img');\n    if (srcPreImage != '') {\n        elThumbImg.attr('src', srcPreImage).show();\n        if (this.addByLink) {\n            this.elParentOption.find('input[type=hidden]').val(this.frInputHiddenTemp);\n            $(this.elParentOption).find('input[type=file]').remove();\n            $(this.frInputFileTemp).val('');\n        } else {\n            var elCloneInputFile = $(this.frInputFileTemp).clone();\n            var idOption = this.elParentOption.attr('id');\n            elCloneInputFile.attr({\n                name: 'optionImage[' + idOption + ']',\n                class : 'file',\n                style : ''\n            }).removeAttr('style');\n            $(this.elParentOption).find('input[type=file]').remove();\n            $(this.elParentOption).find('input[type=hidden]').remove();\n            $(this.elParentOption).prepend(elCloneInputFile);\n            this.frInputHiddenTemp = '';\n        }\n    } else {\n        $(this.elParentOption).find('input[type=file]').val('');\n        $(this.elParentOption).find('input[type=hidden]').val('');\n        elThumbImg.hide();\n    }\n\n    $(this.frImage).modal('hide');\n}\n\njqAddImageOption.prototype.showIframe = function (e) {\n    var $this = e.currentTarget;\n\n    this.removeMessage();\n    this.elParentOption = $($this).closest(this.parentOption);\n    this.srcThumbImageOption = this.elParentOption.find('img').attr('src');\n\n    if (this.srcThumbImageOption.length) {\n        this.setSrcFramePhoto(this.srcThumbImageOption);\n    } else {\n        $(this.frPreImage).attr('src', '');\n    }\n\n    $(this.frImage).modal('show');\n}\n\njqAddImageOption.prototype.showBoxUpload = function (e) {\n    $(this.frInputFileTemp).click();\n}\n\njqAddImageOption.prototype.preImage = function (e) {\n\n    var $this = this;\n    var input = $($this.frInputFileTemp)[0];\n\n    this.addByLink = false;\n\n    if (this.checkExtensionImage(input.value)) {\n        this.removeMessage();\n\n        if (input.files && input.files[0]) {\n            var reader = new FileReader();\n            reader.onload = function(e) {\n                $($this.frPreImage).attr('src', e.target.result);\n            }\n            reader.readAsDataURL(input.files[0]);\n        }\n    } else {\n        this.showMessage(this.messages.image);\n    }\n}\n\njqAddImageOption.prototype.checkTimeLoadImage = function(url, callback, timeout) {\n    var timeout = timeout || 5000;\n    var timedOut = false, timer;\n    var img = new Image();\n\n    img.onerror = img.onabort = function() {\n        if (!timedOut) {\n            clearTimeout(timer);\n            callback(\"error\");\n        }\n    };\n\n    img.onload = function() {\n        if (!timedOut) {\n            clearTimeout(timer);\n            callback(\"success\");\n        }\n    };\n\n    img.src = url;\n\n    timer = setTimeout(function() {\n        timedOut = true;\n        callback(\"timeout\");\n    }, timeout);\n}\n\njqAddImageOption.prototype.checkExtensionImage = function (value) {\n    var extension = value.substring(value.lastIndexOf('.') + 1).toLowerCase();\n    var ruleExtension = ['gif', 'png', 'bmp', 'jpeg', 'jpg'];\n\n    if (ruleExtension.indexOf(extension) > -1) {\n        return true;\n    }\n\n    return false;\n}\n"]}